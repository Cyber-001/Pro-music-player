<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Music Player - Mukammal Audio Tahrirlash</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #a855f7;
            --accent: #ec4899;
            --dark: #1e293b;
            --darker: #0f172a;
        }
        
        body {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            overflow-x: hidden;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .visualization-container {
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        
        #visualizer {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .bar {
            transition: height 0.1s ease-out;
            border-radius: 4px 4px 0 0;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.8;
        }
        
        .theme-btn {
            transition: all 0.3s ease;
        }
        
        .theme-btn:hover {
            transform: scale(1.05);
        }
        
        .theme-btn.active {
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
            transform: scale(1.1);
        }
        
        .control-btn {
            transition: all 0.2s ease;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }
        
        .effect-btn {
            transition: all 0.3s ease;
        }
        
        .effect-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
            transform: scale(1.05);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }
        
        .waveform {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            height: 120px;
            position: relative;
            overflow: hidden;
        }
        
        .waveform::after {
            content: '';
            position: absolute;
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            animation: waveAnim 3s linear infinite;
        }
        
        @keyframes waveAnim {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .recording .pulse-rec {
            animation: pulseRec 1s infinite;
        }
        
        @keyframes pulseRec {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .eq-band {
            transition: all 0.3s ease;
        }
        
        .eq-band.active {
            background: linear-gradient(to top, var(--primary), var(--secondary));
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }
        
        .effect-control {
            display: none;
            margin-top: 10px;
        }
        
        .effect-control.active {
            display: block;
        }
        
        .playlist-item {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left: 3px solid var(--primary);
        }
        
        .playlist-item.active {
            background: rgba(99, 102, 241, 0.2);
            border-left: 3px solid var(--primary);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen py-8 px-4">
    <header class="text-center mb-8">
        <h1 class="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500 mb-2">
            Pro Music Player
        </h1>
        <p class="text-lg text-gray-300">Musiqangizni ranglar va shakllar orqali his eting va tahrirlang</p>
	<p class="text-gray-300">Avval saytimiz bilan yaqindan tanishib chiqishingizni tavsiya qilamiz!!!</p>
    </header>

    <main class="w-full max-w-6xl mx-auto flex-1">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Left Column - Controls -->
            <div class="lg:col-span-1 glass-effect p-6">
                <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">Audio Boshqaruv</h2>
                
                <div class="mb-6">
                    <input type="file" id="audio-upload" accept="audio/*" class="hidden">
                    <label for="audio-upload" class="bg-gradient-to-r from-blue-600 to-indigo-700 control-btn cursor-pointer rounded-lg px-4 py-3 font-medium flex items-center justify-center gap-2 mb-4">
                        <i class="fas fa-file-audio"></i>
                        Qo'shiq Yuklash
                    </label>
                    
                    <div class="flex gap-2 mb-4">
                        <button id="play-btn" class="flex-1 bg-green-600 hover:bg-green-700 control-btn rounded-lg px-4 py-3 font-medium flex items-center justify-center gap-2">
                            <i class="fas fa-play"></i>
                            Ijro etish
                        </button>
                        <button id="pause-btn" class="flex-1 bg-yellow-600 hover:bg-yellow-700 control-btn rounded-lg px-4 py-3 font-medium flex items-center justify-center gap-2">
                            <i class="fas fa-pause"></i>
                            Pauza
                        </button>
                        <button id="stop-btn" class="flex-1 bg-red-600 hover:bg-red-700 control-btn rounded-lg px-4 py-3 font-medium flex items-center justify-center gap-2">
                            <i class="fas fa-stop"></i>
                            To'xtatish
                        </button>
                    </div>
                    
                    <div class="mb-4">
                        <h3 class="text-lg font-medium mb-2">Hozirgi qo'shiq: <span id="current-song" class="text-blue-300">Qo'shiq tanlanmagan</span></h3>
                        <div class="w-full bg-gray-700 rounded-full h-2.5 mb-1">
                            <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-400">
                            <span id="current-time">0:00</span>
                            <span id="total-time">0:00</span>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">Playlistlar</h2>
                    
                    <div class="mb-4">
                        <h3 class="text-lg font-medium mb-2">Yuklangan Musiqalar</h3>
                        <div id="uploaded-tracks" class="bg-gray-800 rounded-lg p-3 max-h-40 overflow-y-auto mb-3">
                            <p class="text-gray-500 text-center py-4">Hali hech qanday musiqa yuklanmagan</p>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium mb-2">Tahrirlangan Musiqalar</h3>
                        <div id="edited-tracks" class="bg-gray-800 rounded-lg p-3 max-h-40 overflow-y-auto">
                            <p class="text-gray-500 text-center py-4">Hali hech qanday musiqa tahrirlanmagan</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">Vizualizatsiya</h2>
                    <div class="grid grid-cols-3 gap-2">
                        <button data-theme="bars" class="theme-btn active bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 flex flex-col items-center justify-center gap-1">
                            <i class="fas fa-chart-bar text-blue-400"></i>
                            <span class="text-sm">Bar grafik</span>
                        </button>
                        <button data-theme="circle" class="theme-btn bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 flex flex-col items-center justify-center gap-1">
                            <i class="fas fa-circle-nodes text-purple-400"></i>
                            <span class="text-sm">Doira</span>
                        </button>
                        <button data-theme="particles" class="theme-btn bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 flex flex-col items-center justify-center gap-1">
                            <i class="fas fa-fire text-rose-400"></i>
                            <span class="text-sm">Zarrachalar</span>
                        </button>
                        <button data-theme="wave" class="theme-btn bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 flex flex-col items-center justify-center gap-1">
                            <i class="fas fa-wave-square text-cyan-400"></i>
                            <span class="text-sm">To'lqin</span>
                        </button>
                        <button data-theme="spectrum" class="theme-btn bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 flex flex-col items-center justify-center gap-1">
                            <i class="fas fa-sliders-h text-green-400"></i>
                            <span class="text-sm">Spektr</span>
                        </button>
                        <button data-theme="orb" class="theme-btn bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 flex flex-col items-center justify-center gap-1">
                            <i class="fas fa-circle text-yellow-400"></i>
                            <span class="text-sm">Sfera</span>
                        </button>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-2">Rang palitrasi</label>
                        <div class="flex gap-2">
                            <button data-color="rainbow" class="theme-btn active w-8 h-8 rounded-full bg-gradient-to-r from-red-400 to-purple-600"></button>
                            <button data-color="ocean" class="theme-btn w-8 h-8 rounded-full bg-gradient-to-r from-blue-400 to-cyan-500"></button>
                            <button data-color="sunset" class="theme-btn w-8 h-8 rounded-full bg-gradient-to-r from-orange-400 to-rose-500"></button>
                            <button data-color="forest" class="theme-btn w-8 h-8 rounded-full bg-gradient-to-r from-green-400 to-emerald-600"></button>
                            <button data-color="custom" class="theme-btn w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center">
                                <i class="fas fa-sliders-h text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">Equalizer</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="flex justify-between mb-1"><span>Bass</span> <span id="bass-value">0dB</span></label>
                            <input type="range" min="-20" max="20" value="0" class="slider" id="bass-slider">
                        </div>
                        <div>
                            <label class="flex justify-between mb-1"><span>Mid</span> <span id="mid-value">0dB</span></label>
                            <input type="range" min="-20" max="20" value="0" class="slider" id="mid-slider">
                        </div>
                        <div>
                            <label class="flex justify-between mb-1"><span>Treble</span> <span id="treble-value">0dB</span></label>
                            <input type="range" min="-20" max="20" value="0" class="slider" id="treble-slider">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-2">Effektlar</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button data-effect="reverb" class="effect-btn bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 text-sm">
                                <i class="fas fa-volume-up mr-1"></i> Reverb
                            </button>
                            <button data-effect="echo" class="effect-btn bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 text-sm">
                                <i class="fas fa-echo mr-1"></i> Echo
                            </button>
                            <button data-effect="distortion" class="effect-btn bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 text-sm">
                                <i class="fas fa-exclamation-triangle mr-1"></i> Distortion
                            </button>
                            <button data-effect="phaser" class="effect-btn bg-gray-800 hover:bg-gray-700 rounded-lg px-3 py-2 text-sm">
                                <i class="fas fa-wave-square mr-1"></i> Phaser
                            </button>
                        </div>
                        
                        <!-- Effektlar uchun qo'shimcha sozlamalar -->
                        <div id="reverb-control" class="effect-control">
                            <label class="flex justify-between mb-1 mt-2"><span>Reverb miqdori</span> <span id="reverb-value">50%</span></label>
                            <input type="range" min="0" max="100" value="50" class="slider" id="reverb-slider">
                        </div>
                        
                        <div id="echo-control" class="effect-control">
                            <label class="flex justify-between mb-1 mt-2"><span>Echo darajasi</span> <span id="echo-value">30%</span></label>
                            <input type="range" min="0" max="100" value="30" class="slider" id="echo-slider">
                        </div>
                        
                        <div id="distortion-control" class="effect-control">
                            <label class="flex justify-between mb-1 mt-2"><span>Distortion</span> <span id="distortion-value">20%</span></label>
                            <input type="range" min="0" max="100" value="20" class="slider" id="distortion-slider">
                        </div>
                        
                        <div id="phaser-control" class="effect-control">
                            <label class="flex justify-between mb-1 mt-2"><span>Phaser tezligi</span> <span id="phaser-value">0.5</span></label>
                            <input type="range" min="0" max="10" value="5" step="0.1" class="slider" id="phaser-slider">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Middle Column - Visualization -->
            <div class="lg:col-span-2 glass-effect p-6">
                <div class="visualization-container w-full h-80 mb-6">
                    <canvas id="visualizer" class="w-full h-full rounded-xl"></canvas>
                </div>
                
                <div class="tabs flex border-b border-gray-700 mb-4">
                    <button data-tab="edit" class="tab-btn px-4 py-2 font-medium border-b-2 border-transparent hover:border-blue-500 transition-all">Audio Tahrirlash</button>
                    <button data-tab="record" class="tab-btn px-4 py-2 font-medium border-b-2 border-transparent hover:border-blue-500 transition-all">Ovoz Yozish</button>
                    <button data-tab="export" class="tab-btn px-4 py-2 font-medium border-b-2 border-transparent hover:border-blue-500 transition-all">Eksport Qilish</button>
                </div>
                
                <div class="tab-content active" id="edit-tab">
                    <h2 class="text-xl font-semibold mb-4">Audio Tahrirlash</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Kesish (seconds)</label>
                            <div class="flex gap-2">
                                <input type="number" id="cut-start" placeholder="Start" class="bg-gray-800 rounded-lg px-3 py-2 w-full" min="0" value="0">
                                <input type="number" id="cut-end" placeholder="End" class="bg-gray-800 rounded-lg px-3 py-2 w-full" min="0" value="0">
                            </div>
                            <button id="cut-btn" class="mt-2 bg-blue-600 hover:bg-blue-700 control-btn rounded-lg px-4 py-2 w-full">
                                Kesishni qo'llash
                            </button>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Fade</label>
                            <div class="flex gap-2">
                                <input type="number" id="fade-in" placeholder="Fade In (s)" class="bg-gray-800 rounded-lg px-3 py-2 w-full" min="0" value="0">
                                <input type="number" id="fade-out" placeholder="Fade Out (s)" class="bg-gray-800 rounded-lg px-3 py-2 w-full" min="0" value="0">
                            </div>
                            <button id="fade-btn" class="mt-2 bg-blue-600 hover:bg-blue-700 control-btn rounded-lg px-4 py-2 w-full">
                                Fade ni qo'llash
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-2">Audio Treklar</label>
                        <div class="bg-gray-800 rounded-lg p-4 h-32 overflow-y-auto">
                            <div class="text-center text-gray-500 py-8">
                                <i class="fas fa-plus-circle text-2xl mb-2"></i>
                                <p>Treklar bu yerda ko'rinadi</p>
                            </div>
                        </div>
                        <button class="mt-2 bg-gray-700 hover:bg-gray-600 control-btn rounded-lg px-4 py-2 w-full">
                            <i class="fas fa-plus mr-2"></i> Yangi trek qo'shish
                        </button>
                    </div>
                </div>
                
                <div class="tab-content" id="record-tab">
                    <h2 class="text-xl font-semibold mb-4">Ovoz Yozish</h2>
                    <div class="bg-gray-800 rounded-lg p-4 mb-4">
                        <div class="waveform mb-4 rounded-lg"></div>
                        <div class="flex justify-center gap-4">
                            <button id="record-btn" class="pulse-rec bg-red-600 hover:bg-red-700 control-btn rounded-full px-6 py-3 font-medium flex items-center gap-2">
                                <i class="fas fa-microphone"></i>
                                Yozishni boshlash
                            </button>
                            <button id="stop-record-btn" class="bg-gray-600 hover:bg-gray-700 control-btn rounded-full px-6 py-3 font-medium flex items-center gap-2" disabled>
                                <i class="fas fa-stop"></i>
                                To'xtatish
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Yozilgan ovozlar</label>
                        <div id="recorded-audio-list" class="bg-gray-800 rounded-lg p-4 h-32 overflow-y-auto">
                            <div class="text-center text-gray-500 py-8">
                                <i class="fas fa-microphone-slash text-2xl mb-2"></i>
                                <p>Hali hech qanday ovoz yozilmagan</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="export-tab">
                    <h2 class="text-xl font-semibold mb-4">Eksport Qilish</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Audio format</h3>
                            <div class="flex gap-2 mb-4">
                                <button class="format-btn bg-blue-600 hover:bg-blue-700 control-btn rounded-lg px-4 py-2 flex-1" data-format="mp3">MP3</button>
                                <button class="format-btn bg-gray-700 hover:bg-gray-600 control-btn rounded-lg px-4 py-2 flex-1" data-format="wav">WAV</button>
                                <button class="format-btn bg-gray-700 hover:bg-gray-600 control-btn rounded-lg px-4 py-2 flex-1" data-format="ogg">OGG</button>
                            </div>
                            <button id="export-audio-btn" class="bg-green-600 hover:bg-green-700 control-btn rounded-lg px-4 py-2 w-full">
                                <i class="fas fa-download mr-2"></i> Audio yuklab olish
                            </button>
                        </div>
                        
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Vizualizatsiya format</h3>
                            <div class="flex gap-2 mb-4">
                                <button class="video-format-btn bg-blue-600 hover:bg-blue-700 control-btn rounded-lg px-4 py-2 flex-1" data-format="mp4">MP4</button>
                                <button class="video-format-btn bg-gray-700 hover:bg-gray-600 control-btn rounded-lg px-4 py-2 flex-1" data-format="gif">GIF</button>
                                <button class="video-format-btn bg-gray-700 hover:bg-gray-600 control-btn rounded-lg px-4 py-2 flex-1" data-format="webm">WebM</button>
                            </div>
                            <button id="export-video-btn" class="bg-green-600 hover:bg-green-700 control-btn rounded-lg px-4 py-2 w-full">
                                <i class="fas fa-video mr-2"></i> Video yuklab olish
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-medium mb-2">Ulashish</h3>
                        <div class="flex gap-2">
                            <button class="bg-gray-700 hover:bg-gray-600 control-btn rounded-lg px-4 py-2 flex-1">
                                <i class="fab fa-telegram mr-2"></i> Telegram
                            </button>
                            <button class="bg-gray-700 hover:bg-gray-600 control-btn rounded-lg px-4 py-2 flex-1">
                                <i class="fab fa-instagram mr-2"></i> Instagram
                            </button>
                            <button class="bg-gray-700 hover:bg-gray-600 control-btn rounded-lg px-4 py-2 flex-1">
                                <i class="fab fa-tiktok mr-2"></i> TikTok
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center text-gray-500 text-sm mt-8">
        <p>Pro Music Player - Musiqangizni ranglar orqali his eting va ijod qiling</p>
	<p>Faqat sahifaga yangilanish bermang aks holda tahrirlangan musiqangiz o'chib ketishi mumkin!!!</p>
        <p class="mt-1">Â© 2023 Synesthesia Player. Barcha huquqlar himoyalangan.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Asosiy o'zgaruvchilar
            let audioContext;
            let audioElement;
            let analyser;
            let source;
            let dataArray;
            let isPlaying = false;
            let currentTheme = 'bars';
            let currentColorScheme = 'rainbow';
            let particles = [];
            let animationId;
            let audioStartTime = 0;
            let audioEndTime = 0;
            
            // Playlist ma'lumotlari
            let uploadedTracks = [];
            let editedTracks = [];
            let recordedAudios = [];
            
            // Audio effektlari uchun
            let bassFilter, midFilter, trebleFilter;
            let reverbNode, echoNode, distortionNode, phaserNode;
            let gainNode;
            let isReverbActive = false;
            let isEchoActive = false;
            let isDistortionActive = false;
            let isPhaserActive = false;
            
            // Ovoz yozish uchun
            let mediaRecorder;
            let audioChunks = [];
            let isRecording = false;
            
            // DOM elementlar
            const audioUpload = document.getElementById('audio-upload');
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const stopBtn = document.getElementById('stop-btn');
            const currentSong = document.getElementById('current-song');
            const currentTime = document.getElementById('current-time');
            const totalTime = document.getElementById('total-time');
            const progressBar = document.getElementById('progress-bar');
            const canvas = document.getElementById('visualizer');
            const themeButtons = document.querySelectorAll('.theme-btn[data-theme]');
            const colorButtons = document.querySelectorAll('.theme-btn[data-color]');
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const uploadedTracksList = document.getElementById('uploaded-tracks');
            const editedTracksList = document.getElementById('edited-tracks');
            const recordedAudioList = document.getElementById('recorded-audio-list');
            const recordBtn = document.getElementById('record-btn');
            const stopRecordBtn = document.getElementById('stop-record-btn');
            const exportAudioBtn = document.getElementById('export-audio-btn');
            const exportVideoBtn = document.getElementById('export-video-btn');
            const formatButtons = document.querySelectorAll('.format-btn');
            const videoFormatButtons = document.querySelectorAll('.video-format-btn');
            const ctx = canvas.getContext('2d');
            
            let selectedFormat = 'mp3';
            let selectedVideoFormat = 'mp4';
            
            // Format tanlash
            formatButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    formatButtons.forEach(b => b.classList.remove('bg-blue-600', 'hover:bg-blue-700'));
                    formatButtons.forEach(b => b.classList.add('bg-gray-700', 'hover:bg-gray-600'));
                    this.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                    this.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    selectedFormat = this.getAttribute('data-format');
                });
            });
            
            // Video format tanlash
            videoFormatButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    videoFormatButtons.forEach(b => b.classList.remove('bg-blue-600', 'hover:bg-blue-700'));
                    videoFormatButtons.forEach(b => b.classList.add('bg-gray-700', 'hover:bg-gray-600'));
                    this.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                    this.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    selectedVideoFormat = this.getAttribute('data-format');
                });
            });
            
            // Canvas o'lchamlarini sozlash
            function resizeCanvas() {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Fayl yuklash
            audioUpload.addEventListener('change', function(e) {
                if (e.target.files.length) {
                    const file = e.target.files[0];
                    loadAudioFile(file);
                }
            });
            
            // Audio faylni yuklash
            function loadAudioFile(file) {
                if (audioElement) {
                    audioElement.pause();
                    cancelAnimationFrame(animationId);
                }
                
                currentSong.textContent = file.name;
                const url = URL.createObjectURL(file);
                
                audioElement = new Audio(url);
                audioElement.addEventListener('timeupdate', updateProgress);
                audioElement.addEventListener('loadedmetadata', function() {
                    totalTime.textContent = formatTime(audioElement.duration);
                    // Kesish vaqtlarini avtomatik to'ldirish
                    document.getElementById('cut-end').value = Math.floor(audioElement.duration);
                    audioEndTime = audioElement.duration;
                });
                
                setupAudioContext();
                isPlaying = false;
                
                // Audio tugaganda animatsiyani to'xtatish
                audioElement.addEventListener('ended', function() {
                    isPlaying = false;
                    cancelAnimationFrame(animationId);
                    drawStaticVisualization();
                });
                
                // Playlistga qo'shish
                addToUploadedTracks(file.name, url);
            }
            
            // Yuklangan treklarni ro'yxatga qo'shish
            function addToUploadedTracks(name, url) {
                const id = 'track_' + Date.now();
                uploadedTracks.push({ id, name, url });
                updateUploadedTracksList();
            }
            
            // Tahrirlangan treklarni ro'yxatga qo'shish
            function addToEditedTracks(name, url) {
                const id = 'edited_' + Date.now();
                editedTracks.push({ id, name, url });
                updateEditedTracksList();
            }
            
            // Yuklangan treklar ro'yxatini yangilash
            function updateUploadedTracksList() {
                if (uploadedTracks.length === 0) {
                    uploadedTracksList.innerHTML = '<p class="text-gray-500 text-center py-4">Hali hech qanday musiqa yuklanmagan</p>';
                    return;
                }
                
                uploadedTracksList.innerHTML = '';
                uploadedTracks.forEach(track => {
                    const trackElement = document.createElement('div');
                    trackElement.className = 'playlist-item mb-2 p-2 rounded cursor-pointer flex justify-between items-center';
                    trackElement.innerHTML = `
                        <div class="truncate">${track.name}</div>
                        <div class="flex gap-1">
                            <button class="play-track-btn p-1 text-blue-400 hover:text-blue-300" data-id="${track.id}">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="edit-track-btn p-1 text-yellow-400 hover:text-yellow-300" data-id="${track.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    `;
                    uploadedTracksList.appendChild(trackElement);
                    
                    // Play tugmasi ishlashi
                    const playBtn = trackElement.querySelector('.play-track-btn');
                    playBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const trackId = this.getAttribute('data-id');
                        playTrack(trackId, 'uploaded');
                    });
                    
                    // Edit tugmasi ishlashi
                    const editBtn = trackElement.querySelector('.edit-track-btn');
                    editBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const trackId = this.getAttribute('data-id');
                        // Tahrirlash uchun audio ni yuklash
                        const track = uploadedTracks.find(t => t.id === trackId);
                        if (track) {
                            loadAudioFromUrl(track.url, track.name);
                        }
                    });
                });
            }
            
            // Tahrirlangan treklar ro'yxatini yangilash
            function updateEditedTracksList() {
                if (editedTracks.length === 0) {
                    editedTracksList.innerHTML = '<p class="text-gray-500 text-center py-4">Hali hech qanday musiqa tahrirlanmagan</p>';
                    return;
                }
                
                editedTracksList.innerHTML = '';
                editedTracks.forEach(track => {
                    const trackElement = document.createElement('div');
                    trackElement.className = 'playlist-item mb-2 p-2 rounded cursor-pointer flex justify-between items-center';
                    trackElement.innerHTML = `
                        <div class="truncate">${track.name}</div>
                        <div class="flex gap-1">
                            <button class="play-track-btn p-1 text-blue-400 hover:text-blue-300" data-id="${track.id}">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="export-track-btn p-1 text-green-400 hover:text-green-300" data-id="${track.id}">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    `;
                    editedTracksList.appendChild(trackElement);
                    
                    // Play tugmasi ishlashi
                    const playBtn = trackElement.querySelector('.play-track-btn');
                    playBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const trackId = this.getAttribute('data-id');
                        playTrack(trackId, 'edited');
                    });
                    
                    // Export tugmasi ishlashi
                    const exportBtn = trackElement.querySelector('.export-track-btn');
                    exportBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const trackId = this.getAttribute('data-id');
                        const track = editedTracks.find(t => t.id === trackId);
                        if (track) {
                            downloadAudio(track.url, track.name);
                        }
                    });
                });
            }
            
            // URL orqali audio yuklash
            function loadAudioFromUrl(url, name) {
                if (audioElement) {
                    audioElement.pause();
                    cancelAnimationFrame(animationId);
                }
                
                currentSong.textContent = name;
                audioElement = new Audio(url);
                audioElement.addEventListener('timeupdate', updateProgress);
                audioElement.addEventListener('loadedmetadata', function() {
                    totalTime.textContent = formatTime(audioElement.duration);
                    document.getElementById('cut-end').value = Math.floor(audioElement.duration);
                    audioEndTime = audioElement.duration;
                });
                
                setupAudioContext();
                isPlaying = false;
                
                audioElement.addEventListener('ended', function() {
                    isPlaying = false;
                    cancelAnimationFrame(animationId);
                    drawStaticVisualization();
                });
            }
            
            // TreknI ijro etish
            function playTrack(trackId, type) {
                let track;
                if (type === 'uploaded') {
                    track = uploadedTracks.find(t => t.id === trackId);
                } else {
                    track = editedTracks.find(t => t.id === trackId);
                }
                
                if (track) {
                    loadAudioFromUrl(track.url, track.name);
                    setTimeout(() => {
                        playBtn.click();
                    }, 100);
                }
            }
            
            // Vaqtni formatlash
            function formatTime(seconds) {
                const min = Math.floor(seconds / 60);
                const sec = Math.floor(seconds % 60);
                return `${min}:${sec < 10 ? '0' : ''}${sec}`;
            }
            
            // Audio kontekstini sozlash
            function setupAudioContext() {
                if (!audioElement) return;
                
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                source = audioContext.createMediaElementSource(audioElement);
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                
                // Equalizer filterlarini yaratish
                createEqualizer();
                
                // Effektlarni yaratish
                createEffects();
                
                // Gain nodeni yaratish
                gainNode = audioContext.createGain();
                
                // Ulanishlarni sozlash
                source.connect(bassFilter);
                bassFilter.connect(midFilter);
                midFilter.connect(trebleFilter);
                trebleFilter.connect(gainNode);
                gainNode.connect(analyser);
                analyser.connect(audioContext.destination);
                
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                
                // Boshlang'ich vizualizatsiya
                drawStaticVisualization();
            }
            
            // Equalizer filterlarini yaratish
            function createEqualizer() {
                // Bass filter (low frequencies)
                bassFilter = audioContext.createBiquadFilter();
                bassFilter.type = "lowshelf";
                bassFilter.frequency.setValueAtTime(200, audioContext.currentTime);
                bassFilter.gain.setValueAtTime(0, audioContext.currentTime);
                
                // Mid filter (middle frequencies)
                midFilter = audioContext.createBiquadFilter();
                midFilter.type = "peaking";
                midFilter.frequency.setValueAtTime(1500, audioContext.currentTime);
                midFilter.Q.setValueAtTime(1, audioContext.currentTime);
                midFilter.gain.setValueAtTime(0, audioContext.currentTime);
                
                // Treble filter (high frequencies)
                trebleFilter = audioContext.createBiquadFilter();
                trebleFilter.type = "highshelf";
                trebleFilter.frequency.setValueAtTime(3000, audioContext.currentTime);
                trebleFilter.gain.setValueAtTime(0, audioContext.currentTime);
            }
            
            // Effektlarni yaratish
            function createEffects() {
                // Reverb effekti
                reverbNode = audioContext.createConvolver();
                
                // Echo effekti
                echoNode = audioContext.createDelay();
                echoNode.delayTime.setValueAtTime(0.3, audioContext.currentTime);
                
                // Distortion effekti
                distortionNode = audioContext.createWaveShaper();
                distortionNode.curve = makeDistortionCurve(0);
                distortionNode.oversample = '4x';
                
                // Phaser effekti
                phaserNode = audioContext.createBiquadFilter();
                phaserNode.type = "allpass";
                phaserNode.frequency.setValueAtTime(1000, audioContext.currentTime);
            }
            
            // Distortion egrisini yaratish
            function makeDistortionCurve(amount) {
                const k = typeof amount === 'number' ? amount : 0;
                const n_samples = 44100;
                const curve = new Float32Array(n_samples);
                const deg = Math.PI / 180;
                
                for (let i = 0; i < n_samples; i++) {
                    const x = (i * 2) / n_samples - 1;
                    curve[i] = (3 + k) * x * 20 * deg / (Math.PI + k * Math.abs(x));
                }
                return curve;
            }
            
            // Progress bar yangilash
            function updateProgress() {
                if (audioElement.duration) {
                    const current = audioElement.currentTime;
                    
                    // Agar kesish sozlamalari qo'llanilgan bo'lsa
                    if (audioStartTime > 0 && current < audioStartTime) {
                        audioElement.currentTime = audioStartTime;
                        return;
                    }
                    
                    if (audioEndTime > 0 && current > audioEndTime) {
                        if (audioElement.loop) {
                            audioElement.currentTime = audioStartTime;
                        } else {
                            audioElement.pause();
                            isPlaying = false;
                            cancelAnimationFrame(animationId);
                            drawStaticVisualization();
                        }
                        return;
                    }
                    
                    const percent = ((current - audioStartTime) / (audioEndTime - audioStartTime)) * 100;
                    progressBar.style.width = percent + '%';
                    currentTime.textContent = formatTime(current);
                }
            }
            
            // Ijro etish tugmasi
            playBtn.addEventListener('click', function() {
                if (!audioElement) {
                    alert('Iltimos, avval audio fayl yuklang');
                    return;
                }
                
                if (!isPlaying) {
                    if (audioContext.state === 'suspended') {
                        audioContext.resume();
                    }
                    
                    // Agar kesish sozlamalari qo'llanilgan bo'lsa, audio ni to'g'ri joydan boshlash
                    if (audioStartTime > 0 && audioElement.currentTime < audioStartTime) {
                        audioElement.currentTime = audioStartTime;
                    }
                    
                    audioElement.play();
                    isPlaying = true;
                    animateVisualization();
                }
            });
            
            // Pauza tugmasi
            pauseBtn.addEventListener('click', function() {
                if (audioElement && isPlaying) {
                    audioElement.pause();
                    isPlaying = false;
                    cancelAnimationFrame(animationId);
                }
            });
            
            // To'xtatish tugmasi
            stopBtn.addEventListener('click', function() {
                if (audioElement) {
                    audioElement.pause();
                    audioElement.currentTime = 0;
                    isPlaying = false;
                    cancelAnimationFrame(animationId);
                    drawStaticVisualization();
                    progressBar.style.width = '0%';
                    currentTime.textContent = '0:00';
                }
            });
            
            // Tema tanlash
            themeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    themeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentTheme = this.getAttribute('data-theme');
                    
                    if (!isPlaying) {
                        drawStaticVisualization();
                    }
                });
            });
            
            // Rang tanlash
            colorButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    colorButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentColorScheme = this.getAttribute('data-color');
                    
                    if (!isPlaying) {
                        drawStaticVisualization();
                    }
                });
            });
            
            // Tablar uchun
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    tabButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // Equalizer slayderlari
            const bassSlider = document.getElementById('bass-slider');
            const midSlider = document.getElementById('mid-slider');
            const trebleSlider = document.getElementById('treble-slider');
            const bassValue = document.getElementById('bass-value');
            const midValue = document.getElementById('mid-value');
            const trebleValue = document.getElementById('treble-value');
            
            bassSlider.addEventListener('input', function() {
                const value = parseInt(this.value);
                bassValue.textContent = `${value}dB`;
                if (bassFilter) {
                    bassFilter.gain.setValueAtTime(value, audioContext.currentTime);
                }
            });
            
            midSlider.addEventListener('input', function() {
                const value = parseInt(this.value);
                midValue.textContent = `${value}dB`;
                if (midFilter) {
                    midFilter.gain.setValueAtTime(value, audioContext.currentTime);
                }
            });
            
            trebleSlider.addEventListener('input', function() {
                const value = parseInt(this.value);
                trebleValue.textContent = `${value}dB`;
                if (trebleFilter) {
                    trebleFilter.gain.setValueAtTime(value, audioContext.currentTime);
                }
            });
            
            // Effekt tugmalari
            const effectButtons = document.querySelectorAll('.effect-btn');
            effectButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const effect = this.getAttribute('data-effect');
                    toggleEffect(effect, this.classList.contains('active'));
                    
                    // Effekt sozlamalarini ko'rsatish/yashirish
                    const controlElement = document.getElementById(`${effect}-control`);
                    if (controlElement) {
                        if (this.classList.contains('active')) {
                            controlElement.classList.add('active');
                        } else {
                            controlElement.classList.remove('active');
                        }
                    }
                });
            });
            
            // Effektlarni yoqish/o'chirish
            function toggleEffect(effect, isActive) {
                // Avval barcha effektlarni audio graphdan olib tashlaymiz
                disconnectEffects();
                
                // Keyin faqat tanlangan effektlarni qo'shamiz
                if (isReverbActive) {
                    gainNode.connect(reverbNode);
                    reverbNode.connect(analyser);
                } else if (isEchoActive) {
                    gainNode.connect(echoNode);
                    echoNode.connect(analyser);
                } else if (isDistortionActive) {
                    gainNode.connect(distortionNode);
                    distortionNode.connect(analyser);
                } else if (isPhaserActive) {
                    gainNode.connect(phaserNode);
                    phaserNode.connect(analyser);
                } else {
                    gainNode.connect(analyser);
                }
                
                // Yangi holatni saqlaymiz
                switch(effect) {
                    case 'reverb':
                        isReverbActive = isActive;
                        break;
                    case 'echo':
                        isEchoActive = isActive;
                        break;
                    case 'distortion':
                        isDistortionActive = isActive;
                        break;
                    case 'phaser':
                        isPhaserActive = isActive;
                        break;
                }
                
                // Qayta ulash
                reconnectEffects();
            }
            
            // Effektlarni audio graphdan olib tashlash
            function disconnectEffects() {
                if (gainNode) gainNode.disconnect();
                if (reverbNode) reverbNode.disconnect();
                if (echoNode) echoNode.disconnect();
                if (distortionNode) distortionNode.disconnect();
                if (phaserNode) phaserNode.disconnect();
            }
            
            // Effektlarni audio graphga qayta ulash
            function reconnectEffects() {
                if (!source || !analyser) return;
                
                // Asosiy audio zanjir
                source.connect(bassFilter);
                bassFilter.connect(midFilter);
                midFilter.connect(trebleFilter);
                trebleFilter.connect(gainNode);
                
                // Effektlarni ulash
                if (isReverbActive) {
                    gainNode.connect(reverbNode);
                    reverbNode.connect(analyser);
                } else if (isEchoActive) {
                    gainNode.connect(echoNode);
                    echoNode.connect(analyser);
                } else if (isDistortionActive) {
                    gainNode.connect(distortionNode);
                    distortionNode.connect(analyser);
                } else if (isPhaserActive) {
                    gainNode.connect(phaserNode);
                    phaserNode.connect(analyser);
                } else {
                    gainNode.connect(analyser);
                }
                
                analyser.connect(audioContext.destination);
            }
            
            // Effekt sozlamalari uchun slayderlar
            const reverbSlider = document.getElementById('reverb-slider');
            const echoSlider = document.getElementById('echo-slider');
            const distortionSlider = document.getElementById('distortion-slider');
            const phaserSlider = document.getElementById('phaser-slider');
            const reverbValue = document.getElementById('reverb-value');
            const echoValue = document.getElementById('echo-value');
            const distortionValue = document.getElementById('distortion-value');
            const phaserValue = document.getElementById('phaser-value');
            
            reverbSlider.addEventListener('input', function() {
                const value = parseInt(this.value);
                reverbValue.textContent = `${value}%`;
                // Reverb sozlamalarini o'zgartirish
            });
            
            echoSlider.addEventListener('input', function() {
                const value = parseInt(this.value);
                echoValue.textContent = `${value}%`;
                if (echoNode) {
                    echoNode.delayTime.setValueAtTime(value/100, audioContext.currentTime);
                }
            });
            
            distortionSlider.addEventListener('input', function() {
                const value = parseInt(this.value);
                distortionValue.textContent = `${value}%`;
                if (distortionNode) {
                    distortionNode.curve = makeDistortionCurve(value);
                }
            });
            
            phaserSlider.addEventListener('input', function() {
                const value = parseFloat(this.value);
                phaserValue.textContent = value;
                if (phaserNode) {
                    phaserNode.frequency.setValueAtTime(value * 100, audioContext.currentTime);
                }
            });
            
            // Kesish funksiyasi
            const cutBtn = document.getElementById('cut-btn');
            const cutStartInput = document.getElementById('cut-start');
            const cutEndInput = document.getElementById('cut-end');
            
            cutBtn.addEventListener('click', function() {
                const start = parseFloat(cutStartInput.value);
                const end = parseFloat(cutEndInput.value);
                
                if (isNaN(start) || isNaN(end) || start >= end) {
                    alert('Iltimos, boshlanish va tugash vaqtlarini toâgâri kiriting');
                    return;
                }
                
                if (audioElement) {
                    audioStartTime = start;
                    audioEndTime = end;
                    
                    // Agar audio ijro etayotgan bo'lsa, yangi vaqtga o'tkazish
                    if (isPlaying) {
                        if (audioElement.currentTime < start || audioElement.currentTime > end) {
                            audioElement.currentTime = start;
                        }
                    }
                    
                    // Tahrirlangan trekni yaratish
                    const editedName = `Tahrirlangan: ${currentSong.textContent}`;
                    addToEditedTracks(editedName, audioElement.src);
                    
                    alert(`Audio ${start} soniyadan ${end} soniyagacha kesildi va tahrirlanganlar ro'yxatiga qo'shildi`);
                } else {
                    alert('Iltimos, avval audio fayl yuklang');
                }
            });
            
            // Fade funksiyasi
            const fadeBtn = document.getElementById('fade-btn');
            const fadeInInput = document.getElementById('fade-in');
            const fadeOutInput = document.getElementById('fade-out');
            
            fadeBtn.addEventListener('click', function() {
                const fadeIn = parseFloat(fadeInInput.value);
                const fadeOut = parseFloat(fadeOutInput.value);
                
                if (isNaN(fadeIn) || isNaN(fadeOut) || fadeIn < 0 || fadeOut < 0) {
                    alert('Iltimos, fade vaqtlarini toâgâri kiriting');
                    return;
                }
                
                if (audioElement) {
                    // Fade in effekti
                    if (fadeIn > 0) {
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(1, audioContext.currentTime + fadeIn);
                    }
                    
                    // Fade out effekti
                    if (fadeOut > 0) {
                        const fadeOutTime = audioElement.duration - fadeOut;
                        gainNode.gain.setValueAtTime(1, audioContext.currentTime + fadeOutTime);
                        gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + audioElement.duration);
                    }
                    
                    // Tahrirlangan trekni yaratish
                    const editedName = `Fade: ${currentSong.textContent}`;
                    addToEditedTracks(editedName, audioElement.src);
                    
                    alert(`Fade in: ${fadeIn}s, Fade out: ${fadeOut}s qo'llandi va tahrirlanganlar ro'yxatiga qo'shildi`);
                } else {
                    alert('Iltimos, avval audio fayl yuklang');
                }
            });
            
            // Ovoz yozish funksiyasi
            recordBtn.addEventListener('click', async function() {
                if (isRecording) return;
                
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = function(event) {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = function() {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        const audioName = `Yozilgan ovoz ${new Date().toLocaleTimeString()}`;
                        
                        // Ro'yxatga qo'shish
                        recordedAudios.push({ name: audioName, url: audioUrl });
                        updateRecordedAudioList();
                        
                        // Streamni to'xtatish
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    recordBtn.disabled = true;
                    stopRecordBtn.disabled = false;
                    recordBtn.classList.add('recording');
                    
                } catch (error) {
                    console.error('Microphone access error:', error);
                    alert('Microphonedan foydalanish ruxsati berilmadi');
                }
            });
            
            // Ovoz yozishni to'xtatish
            stopRecordBtn.addEventListener('click', function() {
                if (mediaRecorder && isRecording) {
                    mediaRecorder.stop();
                    isRecording = false;
                    recordBtn.disabled = false;
                    stopRecordBtn.disabled = true;
                    recordBtn.classList.remove('recording');
                }
            });
            
            // Yozilgan ovozlar ro'yxatini yangilash
            function updateRecordedAudioList() {
                if (recordedAudios.length === 0) {
                    recordedAudioList.innerHTML = '<div class="text-center text-gray-500 py-8"><i class="fas fa-microphone-slash text-2xl mb-2"></i><p>Hali hech qanday ovoz yozilmagan</p></div>';
                    return;
                }
                
                recordedAudioList.innerHTML = '';
                recordedAudios.forEach((audio, index) => {
                    const audioElement = document.createElement('div');
                    audioElement.className = 'playlist-item mb-2 p-2 rounded cursor-pointer flex justify-between items-center';
                    audioElement.innerHTML = `
                        <div class="truncate">${audio.name}</div>
                        <div class="flex gap-1">
                            <button class="play-recorded-btn p-1 text-blue-400 hover:text-blue-300" data-index="${index}">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="download-recorded-btn p-1 text-green-400 hover:text-green-300" data-index="${index}">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    `;
                    recordedAudioList.appendChild(audioElement);
                    
                    // Play tugmasi ishlashi
                    const playBtn = audioElement.querySelector('.play-recorded-btn');
                    playBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const audioIndex = this.getAttribute('data-index');
                        playRecordedAudio(audioIndex);
                    });
                    
                    // Download tugmasi ishlashi
                    const downloadBtn = audioElement.querySelector('.download-recorded-btn');
                    downloadBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const audioIndex = this.getAttribute('data-index');
                        downloadRecordedAudio(audioIndex);
                    });
                });
            }
            
            // Yozilgan ovozni ijro etish
            function playRecordedAudio(index) {
                const audio = recordedAudios[index];
                if (audio) {
                    loadAudioFromUrl(audio.url, audio.name);
                    setTimeout(() => {
                        playBtn.click();
                    }, 100);
                }
            }
            
            // Yozilgan ovozni yuklab olish
            function downloadRecordedAudio(index) {
                const audio = recordedAudios[index];
                if (audio) {
                    downloadAudio(audio.url, audio.name);
                }
            }
            
            // Audio yuklab olish
            function downloadAudio(url, name) {
                const a = document.createElement('a');
                a.href = url;
                a.download = name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
            
            // Audio eksport qilish
            exportAudioBtn.addEventListener('click', function() {
                if (!audioElement) {
                    alert('Iltimos, avval audio yuklang');
                    return;
                }
                
                const fileName = `exported_audio_${new Date().getTime()}.${selectedFormat}`;
                downloadAudio(audioElement.src, fileName);
            });
            
            // Video eksport qilish (simulyatsiya)
            exportVideoBtn.addEventListener('click', function() {
                if (!isPlaying) {
                    alert('Video yozib olish uchun avval audio ijro etilayotgan boÊ»lishi kerak');
                    return;
                }
                
                // Bu faqat simulyatsiya, haqiqiy video yozib olish uchun MediaRecorder API dan foydalanish kerak
                alert(`Video yozib olish boshlandi. Format: ${selectedVideoFormat}\n\nEslatma: Bu faqat namoyish qilish uchun. Haqiqiy video yozib olish uchun qo'shimcha kod kerak.`);
                
                // Simulyatsiya: 3 soniyadan keyin yuklab olish
                setTimeout(() => {
                    const fileName = `synesthesia_video_${new Date().getTime()}.${selectedVideoFormat}`;
                    // Bu faqat simulyatsiya, haqiqiy video fayl yaratilmaydi
                    alert(`${fileName} fayli yuklab olindi (simulyatsiya)`);
                }, 3000);
            });
            
            // Statik vizualizatsiya (audio ijro etilmayotganda)
            function drawStaticVisualization() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                switch(currentTheme) {
                    case 'bars':
                        drawStaticBars();
                        break;
                    case 'circle':
                        drawStaticCircle();
                        break;
                    case 'particles':
                        drawStaticParticles();
                        break;
                    case 'wave':
                        drawStaticWave();
                        break;
                    case 'spectrum':
                        drawStaticSpectrum();
                        break;
                    case 'orb':
                        drawStaticOrb();
                        break;
                }
            }
            
            // Statik bar grafik
            function drawStaticBars() {
                const barCount = 50;
                const barWidth = canvas.width / barCount;
                
                for (let i = 0; i < barCount; i++) {
                    const height = Math.random() * canvas.height / 2;
                    const x = i * barWidth;
                    const y = canvas.height - height;
                    
                    const hue = i * 360 / barCount;
                    ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
                    ctx.fillRect(x, y, barWidth - 2, height);
                }
            }
            
            // Statik doira
            function drawStaticCircle() {
                const radius = Math.min(canvas.width, canvas.height) / 3;
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                gradient.addColorStop(0, 'rgba(255, 100, 100, 0.8)');
                gradient.addColorStop(1, 'rgba(100, 100, 255, 0.4)');
                
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Ichki doira
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius / 2, 0, 2 * Math.PI);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.fill();
            }
            
            // Statik zarrachalar
            function drawStaticParticles() {
                if (particles.length === 0) {
                    for (let i = 0; i < 50; i++) {
                        particles.push({
                            x: Math.random() * canvas.width,
                            y: Math.random() * canvas.height,
                            radius: Math.random() * 5 + 1,
                            color: `hsl(${Math.random() * 360}, 80%, 60%)`,
                            vx: (Math.random() - 0.5) * 0.5,
                            vy: (Math.random() - 0.5) * 0.5
                        });
                    }
                }
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, 2 * Math.PI);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                });
            }
            
            // Statik to'lqin
            function drawStaticWave() {
                ctx.beginPath();
                ctx.moveTo(0, canvas.height / 2);
                
                for (let i = 0; i < canvas.width; i += 5) {
                    const y = canvas.height / 2 + Math.sin(i * 0.05) * 30;
                    ctx.lineTo(i, y);
                }
                
                ctx.lineTo(canvas.width, canvas.height / 2);
                ctx.strokeStyle = 'rgba(100, 200, 255, 0.7)';
                ctx.lineWidth = 3;
                ctx.stroke();
            }
            
            // Statik spektr
            function drawStaticSpectrum() {
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, 'rgba(255, 100, 100, 0.8)');
                gradient.addColorStop(0.5, 'rgba(100, 255, 100, 0.5)');
                gradient.addColorStop(1, 'rgba(100, 100, 255, 0.8)');
                
                for (let i = 0; i < canvas.width; i += 3) {
                    const height = Math.random() * canvas.height;
                    ctx.fillRect(i, canvas.height - height, 2, height);
                }
            }
            
            // Statik sfera
            function drawStaticOrb() {
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = Math.min(canvas.width, canvas.height) / 3;
                
                const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
                gradient.addColorStop(0.3, 'rgba(100, 200, 255, 0.7)');
                gradient.addColorStop(1, 'rgba(0, 0, 100, 0.3)');
                
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Yorqinlik nuqtasi
                ctx.beginPath();
                ctx.arc(centerX - radius/3, centerY - radius/3, radius/5, 0, 2 * Math.PI);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.fill();
            }
            
            // Animatsion vizualizatsiya
            function animateVisualization() {
                if (!isPlaying) return;
                
                analyser.getByteFrequencyData(dataArray);
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                switch(currentTheme) {
                    case 'bars':
                        drawBarVisualization();
                        break;
                    case 'circle':
                        drawCircleVisualization();
                        break;
                    case 'particles':
                        drawParticleVisualization();
                        break;
                    case 'wave':
                        drawWaveVisualization();
                        break;
                    case 'spectrum':
                        drawSpectrumVisualization();
                        break;
                    case 'orb':
                        drawOrbVisualization();
                        break;
                }
                
                animationId = requestAnimationFrame(animateVisualization);
            }
            
            // Bar grafik vizualizatsiya
            function drawBarVisualization() {
                const barCount = 64;
                const barWidth = canvas.width / barCount;
                
                for (let i = 0; i < barCount; i++) {
                    const value = dataArray[i];
                    const height = (value / 255) * canvas.height;
                    const x = i * barWidth;
                    const y = canvas.height - height;
                    
                    let hue;
                    if (currentColorScheme === 'rainbow') {
                        hue = i * 360 / barCount;
                    } else if (currentColorScheme === 'ocean') {
                        hue = 200 + (i * 60 / barCount);
                    } else if (currentColorScheme === 'sunset') {
                        hue = 30 + (i * 40 / barCount);
                    } else if (currentColorScheme === 'forest') {
                        hue = 100 + (i * 60 / barCount);
                    } else {
                        hue = i * 360 / barCount;
                    }
                    
                    ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
                    ctx.fillRect(x, y, barWidth - 2, height);
                }
            }
            
            // Doira vizualizatsiya
            function drawCircleVisualization() {
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const maxRadius = Math.min(canvas.width, canvas.height) / 2.5;
                
                ctx.beginPath();
                ctx.arc(centerX, centerY, maxRadius * 0.3, 0, 2 * Math.PI);
                
                const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, maxRadius);
                gradient.addColorStop(0, 'rgba(255, 100, 100, 0.8)');
                gradient.addColorStop(1, 'rgba(100, 100, 255, 0.4)');
                
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Tashqi aylana
                ctx.beginPath();
                for (let i = 0; i < 64; i++) {
                    const value = dataArray[i];
                    const radius = maxRadius * 0.7 + (value / 255) * maxRadius * 0.3;
                    const angle = (i / 64) * 2 * Math.PI;
                    
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.fillStyle = 'rgba(100, 200, 255, 0.3)';
                ctx.fill();
            }
            
            // Zarrachalar vizualizatsiya
            function drawParticleVisualization() {
                // Zarrachalarni yangilash yoki yaratish
                if (particles.length < 100) {
                    for (let i = 0; i < 5; i++) {
                        particles.push({
                            x: Math.random() * canvas.width,
                            y: canvas.height + Math.random() * 50,
                            radius: Math.random() * 4 + 1,
                            color: `hsl(${Math.random() * 360}, 80%, 60%)`,
                            vx: (Math.random() - 0.5) * 2,
                            vy: -(Math.random() * 3 + 2)
                        });
                    }
                }
                
                // Zarrachalarni chizish va harakatlantirish
                particles.forEach((p, index) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    // Audio ma'lumotiga qarab tebranish
                    if (index < dataArray.length) {
                        p.vx += (dataArray[index] / 255 - 0.5) * 0.2;
                    }
                    
                    // Ekran chetiga chiqib ketgan zarrachalarni olib tashlash
                    if (p.y < -20 || p.x < -20 || p.x > canvas.width + 20) {
                        particles.splice(index, 1);
                    }
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, 2 * Math.PI);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                });
            }
            
            // To'lqin vizualizatsiya
            function drawWaveVisualization() {
                ctx.beginPath();
                ctx.moveTo(0, canvas.height / 2);
                
                for (let i = 0; i < canvas.width; i++) {
                    const dataIndex = Math.floor((i / canvas.width) * dataArray.length);
                    const value = dataArray[dataIndex];
                    const y = canvas.height / 2 + (value / 255) * canvas.height / 2 * Math.sin(i * 0.05);
                    
                    if (i === 0) {
                        ctx.moveTo(i, y);
                    } else {
                        ctx.lineTo(i, y);
                    }
                }
                
                ctx.strokeStyle = 'rgba(100, 200, 255, 0.7)';
                ctx.lineWidth = 3;
                ctx.stroke();
            }
            
            // Spektr vizualizatsiya
            function drawSpectrumVisualization() {
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, 'rgba(255, 100, 100, 0.8)');
                gradient.addColorStop(0.5, 'rgba(100, 255, 100, 0.5)');
                gradient.addColorStop(1, 'rgba(100, 100, 255, 0.8)');
                
                for (let i = 0; i < dataArray.length; i++) {
                    const value = dataArray[i];
                    const x = (i / dataArray.length) * canvas.width;
                    const height = (value / 255) * canvas.height;
                    
                    ctx.fillStyle = gradient;
                    ctx.fillRect(x, canvas.height - height, 2, height);
                }
            }
            
            // Sfera vizualizatsiya
            function drawOrbVisualization() {
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const baseRadius = Math.min(canvas.width, canvas.height) / 4;
                
                // Asosiy sfera
                const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, baseRadius * 1.5);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
                gradient.addColorStop(0.3, 'rgba(100, 200, 255, 0.7)');
                gradient.addColorStop(1, 'rgba(0, 0, 100, 0.3)');
                
                ctx.beginPath();
                ctx.arc(centerX, centerY, baseRadius, 0, 2 * Math.PI);
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Audio ta'sirida o'zgaruvchi ichki doira
                const avgValue = dataArray.reduce((a, b) => a + b, 0) / dataArray.length;
                const pulseRadius = (avgValue / 255) * baseRadius * 0.5;
                
                ctx.beginPath();
                ctx.arc(centerX, centerY, baseRadius * 0.3 + pulseRadius, 0, 2 * Math.PI);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.fill();
                
                // Yorqinlik nuqtasi
                ctx.beginPath();
                ctx.arc(centerX - baseRadius/3, centerY - baseRadius/3, baseRadius/6, 0, 2 * Math.PI);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.fill();
            }
            
            // Drayv and drag-and-drop qo'llab-quvvatlash
            canvas.addEventListener('dragover', function(e) {
                e.preventDefault();
                canvas.style.border = '2px dashed #4fd1c5';
            });
            
            canvas.addEventListener('dragleave', function() {
                canvas.style.border = '';
            });
            
            canvas.addEventListener('drop', function(e) {
                e.preventDefault();
                canvas.style.border = '';
                
                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    if (file.type.startsWith('audio/')) {
                        loadAudioFile(file);
                    } else {
                        alert('Iltimos, faqat audio fayl yuklang');
                    }
                }
            });
            
            // Boshlang'ich statik vizualizatsiya
            drawStaticVisualization();
        });
    </script>
</body>
</html>